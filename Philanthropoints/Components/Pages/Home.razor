@page "/"

<PageTitle>PhilanthroPoints for Birthday Connections</PageTitle>

<!-- * TODO: make these centered and fit color pallette & style of Birthday Connections -->

<div class="">
    <div class="">
        <h1>PhilanthroPoints</h1>
    </div>

    <div class="">
        <h3>Welcome to the Birthday Marketplace, Powered by PhilanthroPoints</h3>
    </div>

    <div class="">
        <input placeholder="Enter ID or Email" @bind="IDEmail" />
    </div>

    <div class="">
        <button @onclick="ValidateLogin">Login</button>
    </div>
</div>



@code 
{
    private string? IDEmail;
    private void ValidateLogin()
    {
        if (string.IsNullOrEmpty(IDEmail))
        {
            // Input is empty, no validation needed
            return;
        }

        if (IsValidUsername(IDEmail) || IsValidEmail(IDEmail))
        {
            // Input is valid
        }
        else
        {
            // Input is invalid
            IDEmail = string.Empty; // Clear the input field
//            ValidationMessageStore.Clear();
//            ValidationMessageStore.Add("IDEmail", "Invalid username or email format.");
        }
    }

    private bool IsValidUsername(string value)
    {
        if (value.Length < 10) return false;
        var prefix = value.Substring(0, 3);
        var datePart = value.Substring(3);

        if (!prefix.All(char.IsLetter)) return false;
        if (!datePart.All(char.IsDigit)) return false;

        if (datePart.Length != 8) return false;

        int month, day, year;
        if (!int.TryParse(datePart.Substring(0, 2), out month) ||
            !int.TryParse(datePart.Substring(2, 2), out day) ||
            !int.TryParse(datePart.Substring(4, 4), out year))
        {
            return false;
        }

        if (month < 1 || month > 12) return false;
        if (day < 1 || day > 31) return false;

        return true;
    }

    private bool IsValidEmail(string value)
    {
        try
        {
            var addr = new System.Net.Mail.MailAddress(value);
            return addr.Address == value;
        }
        catch
        {
            return false;
        }
    }
}